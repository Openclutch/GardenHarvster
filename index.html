<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Garden Duo — 2D Co‑op Browser Game</title>
  <style>
    html, body { height: 100%; margin: 0; overflow:hidden; background:#dfeee3; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    #wrap { display:flex; flex-direction:column; height:100%; }
    header { background:#20303c; color:#fff; padding:8px 12px; font-weight:600; display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    header .pill { background:#2f4656; padding:4px 8px; border-radius:999px; font-weight:600; }
    header .hint { opacity:.9; font-weight:400; }
    header button { border:1px solid #1a2730; background:#2f4656; color:#e8f6ff; border-radius:999px; padding:4px 10px; cursor:pointer; }
    header .savebar { display:flex; gap:8px; align-items:center; margin-left:auto; }
    header .savebar input[type=file]{ display:none; }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    #gameArea { position:relative; flex:1; }
    canvas { width:100%; height:100%; display:block; image-rendering: pixelated; }

    /* Overlay windows */
    .window { position:absolute; top:10px; left:10px; display:flex; gap:10px; }
    .panel { background:#ffffffdd; border:2px solid #333; border-radius:8px; padding:10px; width:190px; display:flex; flex-direction:column; max-height:min(78vh, 620px); }
    .panel h3 { margin:0 0 6px 0; font-size:16px; }
    .panel .row { display:flex; align-items:center; justify-content:space-between; gap:6px; margin:6px 0; }
      .panel button { padding:6px 8px; border-radius:6px; border:1px solid #222; background:#e8f3ff; cursor:pointer; }
      .seed-list { flex:1 1 auto; max-height:min(60vh, 540px); overflow-y:auto; }

    /* Event feed (starts OFF‑SCREEN) */
    #events { position:absolute; right:-380px; top:10px; width:340px; max-width:48vw; background:#ffffffd9; border:2px solid #333; border-radius:8px; padding:8px 10px; transition:right .18s ease-out; }
    #events.open { right:10px; }
    #events h3 { margin:0 0 6px 0; font-size:16px; }
    #feed { max-height:40vh; overflow:auto; font-size:13px; line-height:1.3; }
    .evt { padding:4px 0; border-bottom:1px dashed #ccc; }

    /* Tooltip */
    #tooltip { position:absolute; pointer-events:none; background:#111; color:#fff; padding:4px 6px; border-radius:4px; font-size:12px; transform:translate(-50%, -140%); opacity:0; transition:opacity .08s; white-space:nowrap; }

    /* Footer help */
    footer { background:#20303c; color:#cfe3ff; padding:6px 10px; font-size:14px; display:flex; justify-conte-between; gap:10px; flex-wrap:wrap; }
    footer code { background:#0f1b23; color:#b3e6ff; padding:2px 6px; border-radius:6px; }

    /* Touch controls */
    .touch-controls { position:absolute; bottom:clamp(20px, 8vh, 96px); display:flex; align-items:center; gap:24px; z-index:10; }
    .touch-controls button { touch-action:none; user-select:none; font-size:16px; font-weight:600; display:flex; align-items:center; justify-content:center; padding:0; }
    #p1Controls, #p2Controls { flex-direction:row; align-items:center; }
    #p1Controls { left:16px; right:auto; }
    #p2Controls { right:16px; left:auto; flex-direction:row-reverse; }
    body.single-player #p1Controls { left:auto; right:16px; }
    .dpad { position:relative; width:120px; height:120px; }
    .dpad button { position:absolute; width:56px; height:56px; background:#ffffffd0; border:1px solid #333; border-radius:12px; font-size:20px; }
    .dpad .up { top:0; left:50%; transform:translate(-50%, 0); }
    .dpad .down { bottom:0; left:50%; transform:translate(-50%, 0); }
    .dpad .left { left:0; top:50%; transform:translate(0, -50%); }
    .dpad .right { right:0; top:50%; transform:translate(0, -50%); }
    .actions { display:flex; flex-direction:column; gap:16px; }
    .actions button { width:84px; height:56px; background:#ffffffd0; border:1px solid #333; border-radius:12px; }
    body.single-player #p1Controls .actions { align-items:flex-end; }
    .p2 { display:none; }
  </style>
</head>
<body>
<div id="wrap">
  <header>
    <div class="pill" id="p1money">P1 Money: ¢0.00</div>
    <div class="pill p2" id="p2money">P2 Money: ¢0.00</div>
    <div class="pill" id="p1hud">P1 Seeds: — | Bag: —</div>
    <div class="pill p2" id="p2hud">P2 Seeds: — | Bag: —</div>
    <button id="toggleEvents" title="Toggle Events (H)">Events</button>
    <div class="savebar">
      <button id="btnSave" title="Save to browser (Autosaves too)">Save</button>
      <button id="btnLoad" title="Load from browser">Load</button>
      <button id="btnExport" title="Download save file">Export</button>
      <button id="btnImport" title="Import save file">Import</button>
      <label for="fileImport" class="sr-only">Import save file</label>
      <input id="fileImport" type="file" accept="application/json" title="Import save file" />
      <button id="addP2" title="Enable second player">Add Player 2</button>
    </div>
    <div class="hint">Growth persists via timestamps. Rotten plants must be <b>fixed</b> by the plot owner for ¢10.00. A random <b>Center Challenge</b> can grant pets with perks.</div>
  </header>
  <div id="gameArea">
    <canvas id="game" width="1280" height="720"></canvas>

    <div class="window" id="vendors">
      <div class="panel" id="shopPanel">
        <h3>Seed Shop</h3>
        <div id="seedList" class="seed-list"></div>
        <div style="font-size:12px;opacity:.8;">Stand in the shop & press your <b>Action</b> key (P1:<code>E</code>, P2:<code>/</code>) to toggle this UI.</div>
      </div>
      <div class="panel" id="sellPanel">
        <h3>Sell Harvest</h3>
        <div id="sellInfo" style="font-size:13px;">Stand at the Sell booth and press Action to sell everything in your bag.</div>
      </div>
    </div>

    <div id="events">
      <h3>Events</h3>
      <div id="feed"></div>
    </div>

    <div id="tooltip"></div>

    <div class="touch-controls" id="p1Controls">
      <div class="dpad">
        <button class="up" data-key="KeyW">▲</button>
        <button class="down" data-key="KeyS">▼</button>
        <button class="left" data-key="KeyA">◀</button>
        <button class="right" data-key="KeyD">▶</button>
      </div>
      <div class="actions">
        <button data-key="KeyQ">Cycle</button>
        <button data-key="KeyE">Action</button>
      </div>
    </div>
    <div class="touch-controls p2" id="p2Controls">
      <div class="dpad">
        <button class="up" data-key="ArrowUp">▲</button>
        <button class="down" data-key="ArrowDown">▼</button>
        <button class="left" data-key="ArrowLeft">◀</button>
        <button class="right" data-key="ArrowRight">▶</button>
      </div>
      <div class="actions">
        <button data-key="Period">Cycle</button>
        <button data-key="Slash">Action</button>
      </div>
    </div>
  </div>
  <footer>
    <div>
      <b>Controls:</b> P1 <code>WASD</code> move, <code>1–0</code> select seed, <code>Q</code> cycle seed, <code>E</code> action.
      Enable P2 via the top-right button; P2 uses <code>Arrows</code> move, <code>Numpad1–0</code> select seed, <code>.</code> cycle seed, <code>/</code> action. <b>H</b> toggles Events panel.
    </div>
    <div>
      Plant on your own plots. If a plant rots, the owner can fix the plot for ¢10.00. Complete center challenges to earn pets (perks!).
    </div>
  </footer>
</div>

<script src="network.js"></script>
<script src="game.js"></script>
</body>
</html>
